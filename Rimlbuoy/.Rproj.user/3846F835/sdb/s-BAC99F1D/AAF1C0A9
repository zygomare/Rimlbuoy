{
    "collab_server" : "",
    "contents" : "# TODO: Calcul aDissous(lambda) \n# \n# Author: thomas\n###############################################################################\nlibrary(nlme)\nlibrary(MASS)\n###############################################################################\n#assemblage de tables\n###############################################################################\nappendDatarow <- function(dataRow,dataFrame, index) {\n  dataFrame[index,] = dataRow\n  return(dataFrame)\n}\nappendDatacol <- function(datacol,dataFrame, index) {\n  dataFrame[,index] = datacol\n\treturn(dataFrame)\n}\n\nappendtotable = function(datacol,dataFrame,index,Bycol,Byrow){\n  \n  if (Bycol == T){\n    data_table=appendDatacol(datacol,dataFrame, index)\n    \n  }\n  if (Byrow == T){\n    data_table=appendDatarow(datacol,dataFrame, index)\n    \n  }\n  \n}\n###############################################################################\n#Lecture fichiers\n###############################################################################\nOD_bs = function (fichiereaupure){\n  a = read.table(fichiereaupure, sep=\",\",header=T)\n  row.names(a)=a$nm\n  a = a[order(a$nm),]  \n  a\n\n}\n\nlecture_abs = function (fichierabsorption){\n  a = read.table(fichierabsorption, sep=\",\",header=T)\n  row.names(a)=a$nm\n  a = a[order(a$nm),]    \n  abs=list(data=a$A,wl=a$nm)\n}\n###############################################################################\n#function de conversion Absorbance/absorption\n###############################################################################\n\nAg_lambda <- function(fichierabsorption,chemin_optique){\n  data = lecture_abs(fichierabsorption)\n    nm690= which(data$wl == 690)\n    nm700= which(data$wl == 700)\n    offset= median(c(data$data[nm690],data$data[nm700]))\n     Coeff = (2.303/chemin_optique)*(abs(data$data)-abs(offset))\n  #Coeff = data$data  \n  Ag = list(wave = data$wl, Coeff = Coeff,offset =offset,absorbance=data$data)\n    return(Ag)\n}\n###############################################################################\n#function de calcule de la pente entre les longueur d'onde désirées\n###############################################################################    \n    \n\nSlope <- function(fichierabsorption,chemin_optique,long_onde_1,long_onde_2){\n    data = Ag_lambda(fichierabsorption,chemin_optique)\n    loga = log(data$Coeff)\n    tab = data.frame(data$wave,loga)\n    \n    x=c(long_onde_1:long_onde_2)  \n    wave1 = which(tab$data.wave == long_onde_1)\n    wave2 = which(tab$data.wave == long_onde_2)\n    #plot(tab)\n    lmfit = lm(tab[wave1:wave2,2]~x)\n    Slope = coef(lmfit)[2]\n    #plot(tab)\n    #abline(lmfit)\n    return(Slope)       \n} \n\n###############################################################################\n#function de calcule de la pente entre les longueur d'onde désirées\n###############################################################################    \n\nSlope_right <- function(fichierabsorption,chemin_optique,long_onde_1,long_onde_2){\n  data = Ag_lambda(fichierabsorption,chemin_optique)\n  #loga = log(data$Coeff)\n  #tab = data(data$wave,loga)\n  \n  x=c(long_onde_1:long_onde_2)  \n  wave1 = which(data$wave == long_onde_1)\n  wave2 = which(data$wave== long_onde_2)\n  Slope = log(data$Coeff[wave1]/data$Coeff[wave2])/length(x)\n  return(Slope)\n  \n} \n###############################################################################\n#function pour appliquer toutes les autres fonctions au dossier desire\n###############################################################################\nprocessDir_for_acdom_calculation = function(dir_abs,chemin_optique,first_wl,last_wl,interval,long_onde_1,long_onde_2,long_onde_3,long_onde_4) {\n  children = list.files(dir_abs,full.names=F,recursive=T)\n  print(length(children))\n  \n  nbre_ligne=seq(first_wl,last_wl,interval)\n  valeurs_abs = matrix(data=,ncol=length(children),nrow=length(nbre_ligne))\n  valeurs_Slope = matrix(data=,ncol=1,nrow=length(children))\n  valeurs_Sr = matrix(data=,ncol=1,nrow=length(children))\n  valeurs_Slope2 = matrix(data=,ncol=1,nrow=length(children))\n  valeurs_A254 = matrix(data=,ncol=1,nrow=length(children))\n  valeurs_Slope3 = matrix(data=,ncol=1,nrow=length(children))\n  valeurs_Slope4 = matrix(data=,ncol=1,nrow=length(children))\n\tname = matrix(data=,ncol=1,nrow=length(children))\n\t\n\tfor(i in 1:length(children)) {\n\t\t\t\tprint(children[i])\t\n\t\t\t\t\n\t\t\t\tAbs = Ag_lambda(paste(dir_abs,\"/\",children[i],sep=\"\"),chemin_optique)            \n\t\t\t   #Slope =Slope(paste(dir_abs,\"/\",children[i],sep=\"\"),chemin_optique,long_onde_1,long_onde_2)\n\t\t\t\t#Slope2 =Slope(paste(dir_abs,\"/\",children[i],sep=\"\"),chemin_optique,long_onde_3,long_onde_4)\n\t\t\t\tSlope3 =Slope_right(paste(dir_abs,\"/\",children[i],sep=\"\"),chemin_optique,long_onde_1,long_onde_2)\n\t\t\t\tSlope4=Slope_right(paste(dir_abs,\"/\",children[i],sep=\"\"),chemin_optique,long_onde_3,long_onde_4)\n\t\t\t\t\n        \n        wl254 = which(Abs$wave==254)\n\t\t\t\twlLong1 = which(Abs$wave==long_onde_1)\n\t\t\t\twlLong2 = which(Abs$wave==long_onde_2)  \n        wlLong3 = which(Abs$wave==long_onde_3)\n\t\t\t\twLLong4 = which(Abs$wave==long_onde_4)\n  \n          #valeurs_Slope= appendDatarow(Slope,valeurs_Slope,i)\n\t\t\t\t#valeurs_Slope2= appendDatarow(Slope2,valeurs_Slope2,i)\n\t\t\t\tvaleurs_Slope3= appendDatarow(Slope3,valeurs_Slope3,i)\n\t\t\t\tvaleurs_Slope4= appendDatarow(Slope4,valeurs_Slope4,i)\n\t\t\t\tvaleurs_Sr= appendDatarow(c(Slope3/Slope4),valeurs_Sr,i)\n\t\t\t\tvaleurs_A254= appendDatarow(Abs$absorbance[wl254],valeurs_A254,i)\n        \n\t\t\t\tvaleurs_abs = appendDatacol(Abs$Coeff,valeurs_abs,i)\t\t\t\t\t\n          name=appendDatarow(children[i],name,i)\n      \n     \n\t\t\t}\n\t\t\t\n\tdonnee_labo = list(data=valeurs_abs,wl=Abs$wave,station=c(name),Slope_at_275=valeurs_Slope,slope_350=valeurs_Slope2,Slope_right_275=valeurs_Slope3,slope_right_350=valeurs_Slope4,Sratio=valeurs_Sr,Absorbance_254=valeurs_A254)\n  data = matrix(donnee_labo$data,nrow=length(nbre_ligne),ncol=length(children))\n  colnames(data)=donnee_labo$station\n  row.names(data)=donnee_labo$wl\n  write.csv( data,paste(Sys.time(),\"data.csv\",sep=\"_\"))\n  selectedwl = which(donnee_labo$wl == 275 | donnee_labo$wl == 295 | donnee_labo$wl == 350 |donnee_labo$wl == 400 | donnee_labo$wl == 500)\n  \n  DATA_optique=matrix(c(donnee_labo$Slope_right_275,donnee_labo$slope_right_350,donnee_labo$Sratio,donnee_labo$Absorbance_254,t(donnee_labo$data[selectedwl,])),nrow=length(children),ncol=9)\n  colnames(DATA_optique)=c(\"Slope_275_295\",\"Slope_350_400\",\"Sr\",\"Absorbance_254 nm\",as.character(donnee_labo$wl[selectedwl]))\n  row.names(DATA_optique)=donnee_labo$station\n  write.csv( DATA_optique,paste(Sys.time(),\"data_optique.csv\",sep=\"_\"))\n  \n  return(donnee_labo )\n}\n\n\n\nif(0){\n  setwd(\"/home/thomas/Documents/\")\n  test_mai =processDir_for_acdom_calculation(\"/home/thomas/Documents/Serious/Maitrise_2010/r_data/inner_filter_effect_correction/Mai/afaire/\",0.1,250,800,1,275,295,350,400)\n  write.table(x=data.frame(test_mai$station,test_mai$data[which(test_mai$wl == 400),]),\"/home/thomas/Dropbox/Script_R/data_400_mai_2010.txt\",sep=\"\\t\")\n  test_aout = processDir_for_acdom_calculation(\"/home/thomas/Documents/Serious/Maitrise_2010/r_data/inner_filter_effect_correction/Aout/Abso/\",0.1,230,800,1,275,295,350,400)\n  write.table(x=data.frame(test_aout$station,test_aout$data[which(test_aout$wl == 400),]),\"/home/thomas/Dropbox/Script_R/data_400_Aout_2010.txt\",sep=\"\\t\")\n  \n  mingan=processDir_for_acdom_calculation(\"/home/thomas/Documents/Serious/Maitrise_2010/Mission_cote_Nord/Aout_2010/Analyses_UQAR/Absorption/reprise/\",0.01,220,800,1,275,295,350,400)\n  write.table(x=data.frame(mingan$station,mingan$data[which(mingan$wl == 400),]),\"/home/thomas/Dropbox/Script_R/data_400_mingan_2010.txt\",sep=\"\\t\")\n  \n  #processDir_for_acdom_calculation(\"/home/thomas/Documents/Serious/Maitrise_2010/r_data/inner_filter_effect_correction/Novembre/Abso/\",0.01,571,275,295,350,400)\nAbso_mars=processDir_for_acdom_calculation(\"/home/thomas/Documents/Serious/Maitrise_2010/r_data/inner_filter_effect_correction/Mars_2011/Absorption/\",0.01,230,800,1,275,295,350,400)\n  write.table(x=data.frame(Abso_mars$station,Abso_mars$data[which(Abso_mars$wl == 400),]),\"/home/thomas/Dropbox/Script_R/data_400_Abso_mars_2010.txt\",sep=\"\\t\")\n  \n  abso_mai_2011=processDir_for_acdom_calculation(\"/home/thomas/Documents/Serious/Maitrise_2010/r_data/inner_filter_effect_correction/Mai_2011/Abso/\",0.01,220,800,1,275,295,350,400)\n  write.table(x=data.frame(abso_mai_2011$station,abso_mai_2011$data[which(abso_mai_2011$wl == 400),]),\"/home/thomas/Dropbox/Script_R/data_400_abso_mai_2011.txt\",sep=\"\\t\")\n  \n#processDir_for_acdom_calculation(\"\",0.1,561,275,295,350,400)\n  \n  \n  processDir_for_acdom_calculation(\"/home/thomas/Documents/Serious/Maitrise_2010/Mission_cote_Nord/Mai_2010/Analyses_UQAR/Absorption/reprise/\",0.1,240,800,1,275,295,350,400)\n \n  processDir_for_acdom_calculation(\"/home/thomas/Documents/Serious/Maitrise_2010/Mission_cote_Nord/Mars_2011/Analyses_UQAR/Absorption/11_05_2011/reprise\",0.01,230,800,1,275,295,350,400)\n  processDir_for_acdom_calculation(\"/home/thomas/Documents/Serious/Maitrise_2010/Mission_cote_Nord/Aout_2010/Analyses_UQAR/Absorption/reprise\",0.01,220,800,1,275,295,350,400)\n  \n  novem_intercal_abso =processDir_for_acdom_calculation(\"/media/Transcend/Serious/projet_NASA_NSPIRE/DOC_St_Lawrence/CDOM Thursday, November 01, 2012 8_07 AM Eastern Daylight Time\",0.01,230,800,1,275,295,350,400)\n}\n\nif(0){\n      \n for(i in 1:27){\n png(paste(\"CDOM absorption coefficient from\",dissou_artic$station[i],\".png\"), width = 2400, height = 2800, pointsize = 50)\n   plot(dissou_artic$wl,dissou_artic$data[,i],ylim=c(0,20),col=3,pch=13,xlab=c(\"Wavelength (nm)\"),ylab=c(\"Absorption coefficient (m-1)\"))\nlegend (400,15,\"Absorption coefficient\",col=3,pch=13,title= paste(dissou_artic$station[i]))\n dev.off()\n   }\n dev.off()\n png(paste(\"Inner filter effect substracted\",children[i],\".png\"), width = 2400, height = 2800, pointsize = 50)\n   \t\t\trepresentationGraphique(eem,eem_corr_inner_filter, \"Inner filter effect substracted \",paste(\"data from\",children[i]))\n\t\t\t\tdev.off()\n }\n\nif(0){\nsetwd(\"/home/thomas/Documents/Serious/VITALS/\")\ntest_VITALS =processDir_for_acdom_calculation(\"VITALS/Abso/\",0.1,230,800,1,275,295,350,400)\n}\n\nif(0){\n  setwd(\"/home/thomas/Documents/Serious/Maitrise_2010/terrain_novembre/Analyses_UQAR/\")\n  test_nov =processDir_for_acdom_calculation(\"Abso/\",0.01,220,800,1,275,295,350,400)\n}\n\nif(0){\n  setwd(\"/run/media/thomas/Transcend/projet_NASA_NSPIRE/DOC_St_Lawrence/\")\n  test =processDir_for_acdom_calculation(\"data_new/\",0.05,230,800,1,275,295,350,400)\n  est =processDir_for_acdom_calculation(\"new_dat_moisie/\",0.01,230,800,1,275,295,350,400)\n  \n}\n  if(0){\n    setwd(\"/run/media/thomas/AQUA_OPTICA/st_lau_abosrption/\")\n    test =processDir_for_acdom_calculation(\"CDOM Tuesday, October 21, 2014 12_01 PM Eastern Daylight Time/\",0.05,230,800,1,275,295,350,400)\n    \n}\n\n\nif(0){\n  setwd(\"/home/thomas/Documents/Serious/Riverscape_Frenette_etal/Photodegradation/aCDOM/\")\n  test =processDir_for_acdom_calculation(\"StLaurent_Juillet2013/320nm_cutoff/5cm/\",0.05,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juillet2013/320nm_cutoff/1cm/\",0.01,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juillet2013/t0_5cm/\",0.05,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juin2013/320nm_cutoff/1cm/\",0.01,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juin2013/320nm_cutoff/5cm/\",0.05,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juin2013/Full_irradiance/5cm/\",0.05,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juin2013/Photoblanchiement/5cm/\",0.05,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juin2013/Photoblanchiement/1cm/\",0.01,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juin2013/t0_1cm/\",0.01,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juin2013/t0_5cm/\",0.05,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juin2013/Visible/5cm/\",0.05,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StLaurent_Juin2013/Visible/1cm/\",0.01,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StMaurice_Juillet2013/320nm_cutoff/1cm/\",0.01,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StMaurice_Juillet2013/320nm_cutoff/5cm/\",0.05,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StMaurice_Juillet2013/t0_5cm/\",0.05,230,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"StMaurice_Juillet2013/320nm_cutoff/1cm/\",0.01,230,800,1,275,295,350,400)\n  \n}\nif(0){\n  setwd(\"/home/jaegth01/Documents/SB/BGRCN/Optic/Absorption/Dissolved/L0/\")\n  test =processDir_for_acdom_calculation(\"Mai_2010/CDOM26102010/\",0.01,240,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"Mai_2010/Wl_250_800/\",0.01,250,800,1,275,295,350,400)\n  test =processDir_for_acdom_calculation(\"Aout_2010/CDOM28102010/\",0.1,230,800,1,275,295,350,400)\n   test =processDir_for_acdom_calculation(\"Mars_2011/CDOM Wednesday, May 11, 2011 1_52 PM Eastern Daylight Time/\",0.1,230,800,1,275,295,350,400)\n}\n\nsetwd(\"~/MEGA/Test_polycap/\")\ntest_poly =processDir_for_acdom_calculation(\"Abs/\",0.1,230,800,1,275,295,350,400)\nfor(i in c(1:5)) {\n  plot(test_poly$wl[c(1:471)],test_poly$data[c(1:471),i],col=i,ylim=c(0,3),xlab=\"Wavelength\",ylab=expression(\"Absorption m\"^{-1}))\n  #legend(400,3,test_poly$station[i],col=i,pch = 'o')\n  par(new=T)\n}\nlegend(400,3,test_poly$station[c(1:5)],col=c(1:5),pch = 'o')\n\n\n",
    "created" : 1476896630495.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2455619580",
    "id" : "AAF1C0A9",
    "lastKnownWriteTime" : 1457533253,
    "last_content_update" : 1457533253,
    "path" : "~/MEGA/R/Script_absorption_dissous.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}